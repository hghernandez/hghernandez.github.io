<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
<title>Hernan Hernandez: Ajuste de multiples series de tiempo y multiples modelos</title>

<meta property="description" itemprop="description" content="Es muy frecuente que en el quehacer cotidiano como científicos de datos nos encontremos ante la necesidad de evaluar múltiples modelos de series de tiempo para más de una de ellas. &#10;Este post muestra como el uso de algunas paquetes como Modeltime, Timetk y sknifedatar puede ser de una gran ayuda para hacer esta tarea más eficiente."/>


<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2022-08-13"/>
<meta property="article:created" itemprop="dateCreated" content="2022-08-13"/>
<meta name="article:author" content="Hernan Hernandez"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Hernan Hernandez: Ajuste de multiples series de tiempo y multiples modelos"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Es muy frecuente que en el quehacer cotidiano como científicos de datos nos encontremos ante la necesidad de evaluar múltiples modelos de series de tiempo para más de una de ellas. &#10;Este post muestra como el uso de algunas paquetes como Modeltime, Timetk y sknifedatar puede ser de una gran ayuda para hacer esta tarea más eficiente."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Hernan Hernandez"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary"/>
<meta property="twitter:title" content="Hernan Hernandez: Ajuste de multiples series de tiempo y multiples modelos"/>
<meta property="twitter:description" content="Es muy frecuente que en el quehacer cotidiano como científicos de datos nos encontremos ante la necesidad de evaluar múltiples modelos de series de tiempo para más de una de ellas. &#10;Este post muestra como el uso de algunas paquetes como Modeltime, Timetk y sknifedatar puede ser de una gran ayuda para hacer esta tarea más eficiente."/>

<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","preview","author","date","output"]}},"value":[{"type":"character","attributes":{},"value":["Ajuste de multiples series de tiempo y multiples modelos"]},{"type":"character","attributes":{},"value":["Es muy frecuente que en el quehacer cotidiano como científicos de datos nos encontremos ante la necesidad de evaluar múltiples modelos de series de tiempo para más de una de ellas. \nEste post muestra como el uso de algunas paquetes como Modeltime, Timetk y sknifedatar puede ser de una gran ayuda para hacer esta tarea más eficiente."]},{"type":"character","attributes":{},"value":["imagenes/preview.jpg"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Hernan Hernandez"]},{"type":"character","attributes":{},"value":["https://example.com/norajones"]}]}]},{"type":"character","attributes":{},"value":["2022-08-13"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_depth","toc_float"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[2]},{"type":"logical","attributes":{},"value":[true]}]}]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["ajuste-multiples-series-de-tiempo_files/anchor-4.2.2/anchor.min.js","ajuste-multiples-series-de-tiempo_files/bowser-1.9.3/bowser.min.js","ajuste-multiples-series-de-tiempo_files/crosstalk-1.2.0/css/crosstalk.min.css","ajuste-multiples-series-de-tiempo_files/crosstalk-1.2.0/js/crosstalk.js","ajuste-multiples-series-de-tiempo_files/crosstalk-1.2.0/js/crosstalk.js.map","ajuste-multiples-series-de-tiempo_files/crosstalk-1.2.0/js/crosstalk.min.js","ajuste-multiples-series-de-tiempo_files/crosstalk-1.2.0/js/crosstalk.min.js.map","ajuste-multiples-series-de-tiempo_files/crosstalk-1.2.0/scss/crosstalk.scss","ajuste-multiples-series-de-tiempo_files/datatables-binding-0.22/datatables.js","ajuste-multiples-series-de-tiempo_files/datatables-css-0.0.0/datatables-crosstalk.css","ajuste-multiples-series-de-tiempo_files/distill-2.2.21/template.v2.js","ajuste-multiples-series-de-tiempo_files/dt-core-1.11.3/css/jquery.dataTables.extra.css","ajuste-multiples-series-de-tiempo_files/dt-core-1.11.3/css/jquery.dataTables.min.css","ajuste-multiples-series-de-tiempo_files/dt-core-1.11.3/js/jquery.dataTables.min.js","ajuste-multiples-series-de-tiempo_files/figure-html5/unnamed-chunk-23-1.png","ajuste-multiples-series-de-tiempo_files/figure-html5/unnamed-chunk-24-1.png","ajuste-multiples-series-de-tiempo_files/figure-html5/view_times_series-1.png","ajuste-multiples-series-de-tiempo_files/header-attrs-2.14/header-attrs.js","ajuste-multiples-series-de-tiempo_files/htmlwidgets-1.5.4/htmlwidgets.js","ajuste-multiples-series-de-tiempo_files/jquery-3.6.0/jquery-3.6.0.js","ajuste-multiples-series-de-tiempo_files/jquery-3.6.0/jquery-3.6.0.min.js","ajuste-multiples-series-de-tiempo_files/jquery-3.6.0/jquery-3.6.0.min.map","ajuste-multiples-series-de-tiempo_files/popper-2.6.0/popper.min.js","ajuste-multiples-series-de-tiempo_files/tippy-6.2.7/tippy-bundle.umd.min.js","ajuste-multiples-series-de-tiempo_files/tippy-6.2.7/tippy-light-border.css","ajuste-multiples-series-de-tiempo_files/tippy-6.2.7/tippy.css","ajuste-multiples-series-de-tiempo_files/tippy-6.2.7/tippy.umd.min.js","ajuste-multiples-series-de-tiempo_files/webcomponents-2.0.0/webcomponents.js","framework_multiple.png","GeoPagosGradiente.png","imagenes/preview.jpg","Modulos/plot_time_series.R","Modulos/view_times_series.R","styles.css","tidymodels.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      if ($(this).children()[0].nodeName == "D-FOOTNOTE") {
        var fn = $(this).children()[0]
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        return "<p>" + $('#ref-' + ref).html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.14/header-attrs.js"></script>
  <script src="../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
  <link href="../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
  <script src="../../site_libs/datatables-binding-0.22/datatables.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="../../site_libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
  <link href="../../site_libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
  <script src="../../site_libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
  <link href="../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
  <script src="../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Ajuste de multiples series de tiempo y multiples modelos","description":"Es muy frecuente que en el quehacer cotidiano como científicos de datos nos encontremos ante la necesidad de evaluar múltiples modelos de series de tiempo para más de una de ellas. \nEste post muestra como el uso de algunas paquetes como Modeltime, Timetk y sknifedatar puede ser de una gran ayuda para hacer esta tarea más eficiente.","authors":[{"author":"Hernan Hernandez","authorURL":"https://example.com/norajones","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2022-08-13T00:00:00.000-03:00","citationText":"Hernandez, 2022"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">Hernan Hernandez</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Sobre mi</a>
<a href="../../proyectos.html">Proyectos</a>
<a href="../../cv.html">CV</a>
<a href="https://www.linkedin.com/in/hernanghernandez/">
<i class="fab fa-linkedin-in" aria-hidden="true"></i>
</a>
<a href="https://github.com/hghernandez">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Ajuste de multiples series de tiempo y multiples modelos</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>Es muy frecuente que en el quehacer cotidiano como científicos de
datos nos encontremos ante la necesidad de evaluar múltiples modelos de
series de tiempo para más de una de ellas. Este post muestra como el uso
de algunas paquetes como Modeltime, Timetk y sknifedatar puede ser de
una gran ayuda para hacer esta tarea más eficiente.</p></p>
</div>

<div class="d-byline">
  Hernan Hernandez <a href="https://example.com/norajones"
class="uri">https://example.com/norajones</a> 
  
<br/>2022-08-13
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#activamos-las-librerias"
id="toc-activamos-las-librerias">Activamos las librerias 📚</a></li>
<li><a href="#introducción" id="toc-introducción">Introducción
🤓</a></li>
<li><a href="#workflow" id="toc-workflow">Workflow</a></li>
<li><a href="#preprocesamiento"
id="toc-preprocesamiento">Preprocesamiento 📝</a></li>
<li><a href="#modelos" id="toc-modelos">Modelos ⚙️</a></li>
<li><a href="#entrenamiento-y-evaluación-de-los-modelos"
id="toc-entrenamiento-y-evaluación-de-los-modelos">Entrenamiento y
Evaluación de los modelos 🤸🏽</a></li>
<li><a href="#selección-del-mejor-modelo"
id="toc-selección-del-mejor-modelo">Selección del mejor modelo
😎</a></li>
<li><a href="#entrenamiento-del-mejor-modelo"
id="toc-entrenamiento-del-mejor-modelo">Entrenamiento del mejor modelo
🏋</a></li>
<li><a href="#forecast-datos" id="toc-forecast-datos">Forecast datos
🔮</a></li>
<li><a href="#algunos-comentarios" id="toc-algunos-comentarios">Algunos
comentarios 🗣</a></li>
</ul>
</nav>
</div>
<h2 id="activamos-las-librerias">Activamos las librerias 📚</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/business-science/modeltime'>modeltime</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://rsample.tidymodels.org'>rsample</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/tidymodels/parsnip'>parsnip</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/tidymodels/recipes'>recipes</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/tidymodels/workflows'>workflows</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyr.tidyverse.org'>tidyr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/rafzamb/sknifedatar'>sknifedatar</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://haozhu233.github.io/kableExtra/'>kableExtra</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/rstudio/DT'>DT</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://lubridate.tidyverse.org'>lubridate</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://httr.r-lib.org/'>httr</a></span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<h2 id="introducción">Introducción 🤓</h2>
<p>El objetivo principal de este post es compartir una serie de paquetes
que son realmente útiles para resolver la compleja tarea de
<strong>ajustar múltiples series de tiempo y múltiples
modelos</strong>💪🏼. Asimismo, hay una breve explicación teórica -que
lejos está de pretender ser exhaustiva- de los aspectos más
sobresalientes de los modelos de series de tiempo ajustados.</p>
<h3 id="cargamos-el-conjunto-de-datos">Cargamos el conjunto de
datos</h3>
<p>Para mostrar el funcionamiento de los paquetes, vamos a utilizar el
<strong>Índice de Precios al Consumidor: Nivel General
(mensual)</strong> por región, desde el 2017 y hasta julio de 2022. Vale
decir que el uso de estos datos es sólo ilustrativo ya que proyectar el
IPC demandaría combinar marcos conceptuales económicos y políticos para
enriquecer los resultados. El data set se obtuvo utilizado la
<strong>API se series de tiempo</strong> del sitio oficial <a
href="https://datos.gob.ar/dataset/jgm_3/archivo/jgm_3.13">datos.gob.ar</a>
A continuación se muestra como consumir los datos.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Hacemos un GET sobre el endpoint</span>
<span class='va'>obj</span> <span class='op'>=</span> <span class='fu'><a href='https://httr.r-lib.org/reference/GET.html'>GET</a></span><span class='op'>(</span><span class='st'>"https://apis.datos.gob.ar/series/api/series?ids=145.3_INGCUYUAL_DICI_M_34,145.3_INGNEAUAL_DICI_M_33,145.3_INGNOAUAL_DICI_M_33,145.3_INGPATUAL_DICI_M_39,145.3_INGGBAUAL_DICI_M_33,145.3_INGNACUAL_DICI_M_38,145.3_INGPAMUAL_DICI_M_38&amp;format=csv"</span><span class='op'>)</span>

<span class='co'># Extraemos el contenido</span>
<span class='va'>content</span> <span class='op'>&lt;-</span> <span class='fu'>httr</span><span class='fu'>::</span><span class='fu'><a href='https://httr.r-lib.org/reference/content.html'>content</a></span><span class='op'>(</span><span class='va'>obj</span>,encoding <span class='op'>=</span> <span class='st'>"UTF-8"</span><span class='op'>)</span> 

<span class='co'># Creamos un dataframe con los datos</span>
<span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='st'>"Mes"</span><span class='op'>=</span> <span class='va'>content</span><span class='op'>$</span><span class='va'>indice_tiempo</span>,
      <span class='st'>"GBA"</span><span class='op'>=</span> <span class='va'>content</span><span class='op'>$</span><span class='va'>ipc_ng_gba_tasa_variacion_mensual</span>,
      <span class='st'>"Cuyo"</span><span class='op'>=</span> <span class='va'>content</span><span class='op'>$</span><span class='va'>ipc_ng_cuyo_tasa_variacion_mensual</span>,
      <span class='st'>"NEA"</span><span class='op'>=</span><span class='va'>content</span><span class='op'>$</span><span class='va'>ipc_ng_nea_tasa_variacion_mensual</span>,
      <span class='st'>"NOA"</span><span class='op'>=</span> <span class='va'>content</span><span class='op'>$</span><span class='va'>ipc_ng_noa_tasa_variacion_mensual</span>,
      <span class='st'>"Pampeana"</span><span class='op'>=</span> <span class='va'>content</span><span class='op'>$</span><span class='va'>ipc_ng_pampeana_tasa_variacion_mensual</span>,
      <span class='st'>"Patagonia"</span><span class='op'>=</span> <span class='va'>content</span><span class='op'>$</span><span class='va'>ipc_ng_patagonia_tasa_variacion_mensual</span>,
      <span class='st'>"Nacional"</span><span class='op'>=</span> <span class='va'>content</span><span class='op'>$</span><span class='va'>ipc_ng_nacional_tasa_variacion_mensual</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>Mes</span>,names_to <span class='op'>=</span> <span class='st'>"Region"</span>, values_to <span class='op'>=</span> <span class='st'>"IPC"</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>IPC <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>IPC</span> <span class='op'>*</span> <span class='fl'>100</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span><span class='st'>"date"</span><span class='op'>=</span> <span class='st'>"Mes"</span>, <span class='st'>"value"</span><span class='op'>=</span> <span class='st'>"IPC"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Ahora echemos un vistazo 🕵🏽 a los datos. Para eso cree una función
que recibe como parámetros un dataframe, el valor para el <em>eje
x</em>, <em>eje y</em>, el <em>tipo de escala</em> y un campo para
<em>facetar el gráfico</em>. Además agregamos una linea de suavización
de la tendencia para observar el comportamiento a lo largo del
tiempo.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>view_times_series</span><span class='op'>(</span>df <span class='op'>=</span> <span class='va'>data</span>,
                  x <span class='op'>=</span> <span class='st'>"date"</span>,
                  y <span class='op'>=</span> <span class='st'>"value"</span>,
                  facet <span class='op'>=</span> <span class='st'>"Region"</span>,
                  title <span class='op'>=</span> <span class='st'>"IPC Nivel General (base 2016) por región"</span>,
                  y_lab <span class='op'>=</span> <span class='st'>"IPC"</span>,
                  scales <span class='op'>=</span> <span class='st'>"free_y"</span>
<span class='op'>)</span>
</code></pre>
</div>
<p><img src="ajuste-multiples-series-de-tiempo_files/figure-html5/view_times_series-1.png" width="864" /></p>
</div>
<h2 id="workflow">Workflow</h2>
<p>La siguiente figura resume con claridad el flujo de trabajo que se
implementa, contrastando la evaluación de una única serie y varios
modelos y de varias series y varios modelos.</p>
<figure>
<img src="framework_multiple.png"
alt="Figura 1: Workflow evaluación de múltiples modelos en múltiples series de tiempo. Obtenido de https://rafael-zambrano-blog-ds.netlify.app/posts/workflowsets_timeseries" />
<figcaption aria-hidden="true">Figura 1: Workflow evaluación de
múltiples modelos en múltiples series de tiempo. Obtenido de <a
href="https://rafael-zambrano-blog-ds.netlify.app/posts/workflowsets_timeseries"
class="uri">https://rafael-zambrano-blog-ds.netlify.app/posts/workflowsets_timeseries</a></figcaption>
</figure>
<p>La Figura 1 muestra la integración de dos flujos de trabajos, por un
lado la de múltiples series de tiempo y modelos y por otro lado el de
entrenamiento de los modelos.</p>
<h3 id="workflow-modelado">Workflow modelado</h3>
<p>Este workflow es implementado en el framework <em>Tidymodels</em>, y
comprende en general las siguientes etapas y librerias:</p>
<!-- # ```{r tidymodels,out.width = "75%", fig.align = "center", echo=FALSE, fig.cap = 'Workflow tidymodels', fig.show = "hold"} -->
<!-- # knitr::include_graphics("tidymodels.png") -->
<!-- #  -->
<!-- # ``` -->
<p><img src="tidymodels.png" alt="Figura 2: Workflow tidymodels" /> El
paquete <strong>Modeltime</strong>, representa una extensión del
framework <strong>Tidymodels</strong>, de ahí que compartan casi todo el
workflow, pero agrega al análisis de series temporales una serie de
funciones que permiten la escalabilidad en la evaluación de múltiples
modelos de series de tiempo. Para ello, implementan un tipo de
pronóstico que definen como <a
href="https://business-science.github.io/modeltime/articles/nested-forecasting.html">pronóstico
anidado</a> y que implica <em>“convertir muchas series de tiempo en un
conjunto de datos anidados y luego ajustar muchos modelos a cada uno de
los datos anidados”</em>. Haremos uso en esta ocasión del paquete
__sknifedatar_ que nos permite vincular <strong>modeltime</strong> con
el conjunto de datos. El workflow implica entonces:</p>
<ol type="1">
<li>Preprocesamiento de las series</li>
<li>Instanciación de los modelos</li>
<li>Entrenamiento de los modelos</li>
<li>Evaluación de los modelos</li>
<li>Selección del mejor modelo</li>
<li>Entrenamiento del mejor modelo</li>
<li>Proyección de datos</li>
<li>Guardamos las proyecciones y la tabla de precisión del mejor
modelo</li>
</ol>
<h2 id="preprocesamiento">Preprocesamiento 📝</h2>
<p>Esta etapa de la evaluación de los modelos de series de tiempo abarca
aquéllas acciones de transformación de los datos para que sean adecuados
para el modelado. Aquí se hace uso del paquete
<strong>recipes()</strong> que nos permite organizar las
transformaciones para el preprocesamiento de la información de forma tal
que sea lo más reproducible posible.</p>
<h4 id="anido-la-serie-de-dato-por-región">Anido la serie de dato por
región</h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>ipc_nested</span> <span class='op'>=</span> <span class='va'>data</span>  <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/nest.html'>nest</a></span><span class='op'>(</span>nested_column<span class='op'>=</span><span class='op'>-</span><span class='va'>Region</span><span class='op'>)</span> 

<span class='va'>ipc_nested</span>
</code></pre>
</div>
<pre><code>## # A tibble: 7 x 2
##   Region    nested_column    
##   &lt;chr&gt;     &lt;list&gt;           
## 1 GBA       &lt;tibble [67 x 2]&gt;
## 2 Cuyo      &lt;tibble [67 x 2]&gt;
## 3 NEA       &lt;tibble [67 x 2]&gt;
## 4 NOA       &lt;tibble [67 x 2]&gt;
## 5 Pampeana  &lt;tibble [67 x 2]&gt;
## 6 Patagonia &lt;tibble [67 x 2]&gt;
## 7 Nacional  &lt;tibble [67 x 2]&gt;</code></pre>
</div>
<h4 id="armamos-las-recetas">Armamos las recetas 🥣</h4>
<p>La receta 1, es la utilizada por los modelos de redes neuronales.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>receta_IPC_1</span> <span class='op'>=</span> <span class='fu'><a href='https://recipes.tidymodels.org/reference/recipe.html'>recipe</a></span><span class='op'>(</span><span class='va'>value</span> <span class='op'>~</span> <span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>data</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>Region</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_date.html'>step_date</a></span><span class='op'>(</span><span class='va'>date</span>, features <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"month"</span>, <span class='st'>"quarter"</span>, <span class='st'>"year"</span><span class='op'>)</span>, ordinal <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Esta receta es utilizada por el resto de los modelos. Una de las
transformaciones que se hace en esta receta es la conversión de la
variable de fecha a una variable de tipo numérica, compatible con los
modelos lineales.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>receta_IPC_2</span> <span class='op'>=</span> <span class='va'>receta_IPC_1</span>  <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_mutate.html'>step_mutate</a></span><span class='op'>(</span>date_num <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>date</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_normalize.html'>step_normalize</a></span><span class='op'>(</span><span class='va'>date_num</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_rm.html'>step_rm</a></span><span class='op'>(</span><span class='va'>date</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_dummy.html'>step_dummy</a></span><span class='op'>(</span><span class='va'>date_month</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>El paquete <strong>recipes()</strong> facilita la transformación y el
procesado de los datos a través de las funciones <em>step()</em>, que a
modo general se utilizan del siguiente modo:</p>
<ul>
<li><p><strong>step_corr():</strong> Elimina las variables que tienen
una correlación alta con otras variables.</p></li>
<li><p><strong>step_center():</strong> Centra los datos para que tengan
media cero.</p></li>
<li><p><strong>step_scale():</strong> Normaliza los datos para que
tengan desvío estandar de 1.</p></li>
</ul>
<p>Estos dos pasos son importantes porque cuando los predictores son
numéricos, la escala en la que se miden, así como la magnitud de su
varianza pueden influir en gran medida en el modelo. Si no se igualan de
los predictores, aquellos que se midan en una escala mayor o que tengan
más varianza dominarán el modelo aunque no sean los que más relación
tienen con la variable respuesta.</p>
<ul>
<li><strong>step_rm():</strong> eliminará las variables en función de su
nombre, tipo o función.</li>
</ul>
<p>Además, existen una diversidad de funciones asociadas a
<strong>step</strong> con diversos usos como: imputar datos a través de
diferentes estrategias (utilizando la media, un modelo lineal, etc),
para transformaciones individuales (transformación logarítmica,
exponencial, etc), ordenamiento, retrasos un muchas otras funciones.</p>
<h2 id="modelos">Modelos ⚙️</h2>
<h4 id="modelo-arima-boosted">Modelo ARIMA boosted</h4>
<p>Los modelos ARIMA fueron propuestos por Box y Jenkins en 1976 y se
caracterizan por realizar predicciones de una variable utilizando como
información la contenida en los valores pasados de la serie temporal. La
sigla ARIMA refiere a <strong>Media Móvil Integrada
AutoRegresiva</strong>. Los términos autorregresivos (AR) se refieren a
los retrasos de la serie diferenciada, los términos de promedio móvil
(MA) se refieren a los retrasos de los errores e I es el número de
diferencia utilizado para hacer que la serie de tiempo sea
estacionaria.</p>
<p>Un punto muy importante a destacar es la implementación en este
modelo del principio de <strong>boosting</strong> para mejorar los
errores del modelado. La idea detrás del boosting es generar múltiples
modelos de predicción secuenciualmente,y que cada uno de estos tome los
resultados del modelo anterior, para generar un modelo más “fuerte”, con
mejor poder predictivo y mayor estabilidad en sus resultados. Para
conseguir un modelo más fuerte, se emplea un algoritmo de optimización,
este caso Gradient Descent (descenso de gradiente). Durante el
entrenamiento, los parámetros de cada modelo débil son ajustados
iterativamente tratando de encontrar el mínimo de una función objetivo,
que puede ser la proporción de error en la clasificación, el área bajo
la curva (AUC), la raíz del error cuadrático medio (RMSE) o alguna otra.
Cada modelo es comparado con el anterior. Si un nuevo modelo tiene
mejores resultados, entonces se toma este como base para realizar nuevas
modificaciones. Si, por el contrario, tiene peores resultados, se
regresa al mejor modelo anterior y se modifica ese de una manera
diferente. <strong>XGBoost</strong> o <strong>Extreme Gradient
Boosting</strong>, es uno de los algoritmos de machine learning de tipo
<em>supervisado</em> más usados en la actualidad. Este algoritmo se
caracteriza por obtener buenos resultados de predicción con
relativamente poco esfuerzo, en muchos casos equiparables o mejores que
los devueltos por modelos más complejos computacionalmente, en
particular para problemas con datos heterogéneos.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m_arima_boosted_ipc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://workflows.tidymodels.org/reference/workflow.html'>workflow</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://workflows.tidymodels.org/reference/add_recipe.html'>add_recipe</a></span><span class='op'>(</span><span class='va'>receta_IPC_1</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://workflows.tidymodels.org/reference/add_model.html'>add_model</a></span><span class='op'>(</span><span class='fu'><a href='https://business-science.github.io/modeltime/reference/arima_boost.html'>arima_boost</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span>engine <span class='op'>=</span> <span class='st'>"auto_arima_xgboost"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="modelo-seasonal">Modelo seasonal</h4>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m_seasonal_ipc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://business-science.github.io/modeltime/reference/seasonal_reg.html'>seasonal_reg</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"stlm_arima"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="modelo-prophet-boosted">Modelo prophet boosted</h4>
<p>Prophet es un procedimiento para pronosticar datos de series
temporales basado en un modelo aditivo en el que las tendencias no
lineales se ajustan a la estacionalidad anual, semanal y diaria, además
de los efectos de las vacaciones. Este paquete de código abierto ha sido
lanzado por el equipo <strong>Core Data Science de
Facebook</strong>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m_prophet_boost_ipc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://workflows.tidymodels.org/reference/workflow.html'>workflow</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://workflows.tidymodels.org/reference/add_recipe.html'>add_recipe</a></span><span class='op'>(</span><span class='va'>receta_IPC_1</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://workflows.tidymodels.org/reference/add_model.html'>add_model</a></span><span class='op'>(</span><span class='fu'><a href='https://business-science.github.io/modeltime/reference/prophet_boost.html'>prophet_boost</a></span><span class='op'>(</span>mode<span class='op'>=</span><span class='st'>'regression'</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"prophet_xgboost"</span><span class='op'>)</span><span class='op'>)</span>  
</code></pre>
</div>
</div>
<h4 id="modelo-nnetar">Modelo NNetar</h4>
<p>Este modelo se basa en redes neuronales con una sola capa oculta y
entradas retrasadas para realizar los pronósticos. Es un modelo
autogresivo no lineal. Los modelos de redes neuronales o ANN (sigla del
ingles Artificial Neural Network), tienen la capacidad de aprender con
el ejemplo y están basados en los sistemas neuronales biológicos. La red
neuronal es un conjunto de unidades de entrada/salida conectadas en las
que cada conexión tiene un peso asociado. En la fase de aprendizaje, la
red aprende ajustando los pesos para predecir la etiqueta de clase
correcta de las entradas dadas. A modo general todos los modelos de ANN
están compuesto de: + <strong>Capa de entrada:</strong> esta
representada por los datos (inputs) del modelo. La cantidad de columnas
que contiene nuestro archivo indicara la cantidad de <em>neuronas</em> o
units del modelo.</p>
<ul>
<li><p><strong>Capa oculta:</strong> recibe los valores de la capa de
entrada, ponderados por los pesos. El conjunto de pesos son
inicializados aleatoriamente al principio y luego optimizados, mediante
algoritmos de aprendizajes.</p></li>
<li><p><strong>Capa de salida:</strong> indica el tipo de salida que
pretendemos obtener, por ejemplo si nuestro objetivo es obtener una
clasificación binaria (0 y 1), entonces la capa de salida contendrá una
sóla neurona.</p></li>
<li><p><strong>Función de activación:</strong> se especifica en la capa
oculta y tiene el objetivo de <strong>agregar no linealidad a nuestra
red</strong> y le permite aprender características complejas. Algunos
ejemplos de estas funciones son: <strong>Sigmoid o Logística</strong>,
<strong>ReLu (unidad lineal rectificada)</strong>, <strong>tanh
(tangente hiperbólica)</strong>,etc.</p></li>
</ul>
<p>La <strong>neurona</strong> es la unidad funcional de los modelos
ANN. Dentro de cada neurona ocurren dos operaciones: la suma ponderada
de sus entradas y la aplicación de una función de activación</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m_nnetar_ipc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://workflows.tidymodels.org/reference/workflow.html'>workflow</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://workflows.tidymodels.org/reference/add_recipe.html'>add_recipe</a></span><span class='op'>(</span><span class='va'>receta_IPC_1</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://workflows.tidymodels.org/reference/add_model.html'>add_model</a></span><span class='op'>(</span><span class='fu'><a href='https://business-science.github.io/modeltime/reference/nnetar_reg.html'>nnetar_reg</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"nnetar"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="modelo-mars">Modelo MARS</h4>
<p>MARS hace referencia a la sigla del inglés <strong>Multivariate
Adaptive Regression Splines</strong>, es decir es un modelo de Regresión
Splines Multivariante Adaptativo. De lo anterior se desprenden varios
términos que es convienente abordar, como son:</p>
<ul>
<li><strong>Splines:</strong> Spline es una función especial definida
por polinomios y representa una técnica de <strong>regresión no
paramétrica</strong> (es decir dónde no debemos asumir linealidad en
nuestros datos). En esta técnica, el conjunto de datos se divide en
contenedores a intervalos o puntos que llamamos nudos, por lo que puede
decirse que <em>“los splines son series de segmentos polinómicos unidos
entre sí en nudos”</em>.</li>
</ul>
<p>Los modelos MARS superan una de las principales desventajas de la
regresión polinomial y que es la dependencia de indicar a priori en que
puntos de la variable <em>x</em> deben hacerse los puntos de corte. Para
ello el procedimiento evalúa cada punto de datos para cada predictor
como un nudo y crea un modelo de regresión lineal con las
características candidatas. El procedimiento MARS primero buscará el
punto único en el rango de valores de <em>x</em> donde dos relaciones
lineales diferentes entre <em>x</em> e <em>y</em> logran el error más
pequeño</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m_mars_ipc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://workflows.tidymodels.org/reference/workflow.html'>workflow</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://workflows.tidymodels.org/reference/add_recipe.html'>add_recipe</a></span><span class='op'>(</span><span class='va'>receta_IPC_2</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://workflows.tidymodels.org/reference/add_model.html'>add_model</a></span><span class='op'>(</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/mars.html'>mars</a></span><span class='op'>(</span>mode <span class='op'>=</span> <span class='st'>"regression"</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"earth"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="modelo-elastic-net">Modelo Elastic net</h4>
<p>El modelo <strong>Elastic net</strong> forma parte del conjunto de
modelos de regresión penalizados, que incluyen los modelos: Ridge, Lasso
y Elastic net.</p>
<p>Son particularmente útiles en el contexto de tener un conjunto de
datos multivariado con una gran gran cantidad de variables, dónde el
método de los mínimos cuadrados (ajuste del modelo lineal), funciona de
forma incorrecta. El pincipio general implica la incorporación de un
término de <strong>penalización</strong> que tiene como consecuencia
reducir (es decir, encoger) los valores de los coeficientes hacia cero.
Esto permite que las variables menos contributivas tengan un coeficiente
cercano a cero o igual a cero. El modelo <strong>Elastic net</strong>
penaliza con la <strong>norma L1</strong> y la <strong>norma L2</strong>
(es decir las que se utilizan en los modelos Lasso y Ridge). Esto
implica: + <strong>norma L1:</strong> es implementada en los modelos de
regresión Lasso. Aquí la penalización tiene el efecto de obligar a
algunas de las estimaciones de los coeficientes, con una contribución
menor al modelo, a ser exactamente iguales a cero. Es una buena
alternativa para la selección de variables con el fin de reducir la
complejidad de los modelos. + <strong>norma L2:</strong> es implementada
en los modelos de regresión Ridge. En este caso la penalización tiene
como efecto la reducción de los coeficientes de regresión, de modo que
las variables con una contribución menor al resultado, tengan sus
coeficientes cercanos a cero.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m_glmnet_ipc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://workflows.tidymodels.org/reference/workflow.html'>workflow</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://workflows.tidymodels.org/reference/add_recipe.html'>add_recipe</a></span><span class='op'>(</span><span class='va'>receta_IPC_2</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://workflows.tidymodels.org/reference/add_model.html'>add_model</a></span><span class='op'>(</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/linear_reg.html'>linear_reg</a></span><span class='op'>(</span>penalty <span class='op'>=</span> <span class='fl'>0.01</span>, mixture <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"glmnet"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="modelo-xgboost-árbol-de-decisión">Modelo Xgboost: Árbol de
decisión</h4>
<p>Más arriba se detallo la estrategia de <strong>boosting</strong> para
reducir los errores del modelado como así también las implementaciones
del paquete <strong>xgboost</strong> en R y en otros lenguajes de uso
cotidiano en ciencias de datos. Pero queda abordar las características
más destacadas de los <strong>árboles de decisión</strong> como modelos
de <em>machine learning</em>. Los <strong>árboles de decisión</strong>
son modelos predictivos formados por reglas binarias (si/no) con las que
se consigue repartir las observaciones en función de sus atributos y
predecir así el valor de la variable respuesta. Se engloban dentro de
los <strong>modelos supervisados de machine learning</strong> es decir
conocemos a priori la variable de respuesta o dependiente que utilizan
técnicas <strong>no paramétricas</strong>. Además de los algoritmos
<strong>Gradiente Boosting</strong>, existen otros como <strong>random
forest</strong> para implementar este tipo de métodos.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m_xgboost_ipc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://workflows.tidymodels.org/reference/workflow.html'>workflow</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://workflows.tidymodels.org/reference/add_recipe.html'>add_recipe</a></span><span class='op'>(</span><span class='va'>receta_IPC_2</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://workflows.tidymodels.org/reference/add_model.html'>add_model</a></span><span class='op'>(</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/boost_tree.html'>boost_tree</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"xgboost"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="entrenamiento-y-evaluación-de-los-modelos">Entrenamiento y
Evaluación de los modelos 🤸🏽</h2>
<h4 id="partición">Partición</h4>
<p>Como primera medida dividimos nuestros datos en datos para
entrenamiento (training) y para test (evaluación). Para este caso
separamos en 80% y 20%</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>split</span> <span class='op'>&lt;-</span> <span class='fl'>0.80</span>
</code></pre>
</div>
</div>
<h4 id="tabla-modelos">Tabla modelos 👨‍🏫</h4>
<p>Creamos una tabla que contiene todos los modelos en evaluación y
dónde se guardarán las métricas con las que compararemos la performance
de los diferentes modelos.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_table_ipc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/sknifedatar/man/modeltime_multifit.html'>modeltime_multifit</a></span><span class='op'>(</span>
  serie <span class='op'>=</span> <span class='va'>ipc_nested</span>,
  .prop <span class='op'>=</span> <span class='va'>split</span>,
  <span class='va'>m_arima_boosted_ipc</span>,
  <span class='va'>m_seasonal_ipc</span>,
  <span class='va'>m_prophet_boost_ipc</span>,
  <span class='va'>m_nnetar_ipc</span>,
  <span class='va'>m_mars_ipc</span>,
  <span class='va'>m_glmnet_ipc</span>,
  <span class='va'>m_xgboost_ipc</span>
  
<span class='op'>)</span>
</code></pre>
</div>
</div>
<h4 id="modelos-evaluados-y-su-correspondiente-métrica-de-error">Modelos
evaluados y su correspondiente métrica de error</h4>
<p>En la tabla se encuentran analizadas las siguientes métricas de
errores:</p>
<ul>
<li><strong>mae (Mean Absolute Error):</strong> es la media de los
errores en valor absoluto. Esta métrica favorece modelos que predicen
muy bien la gran mayoría de observaciones aunque en unas pocas se
equivoque por mucho.</li>
<li><strong>mape (Mean Absolute Porcentaje Error):</strong> representa
el valor absoluto expresado en porcentaje, es decir indica en término
porcentuales la diferencia promedio entre el valor predicho y el
observado.</li>
<li><strong>mase (Mean Absolute Scaled Error):</strong> esta metrica
surge de un algoritmo que compara los pronósticos con el resultado de un
enfoque de pronóstico <em>ingenuo</em>. El <strong>pronóstico
ingenuo</strong> se genera en cualquier paso igualando el pronóstico
actual con el resultado del último paso de tiempo sin considerar
<em>ningún patrón estacional</em>.</li>
<li><strong>smape (Symmetric Mean Absolute Percentage Error):</strong>
representa la diferencia absoluta entre <em>predicho</em> y
<em>observado</em> dividido por la mitad de la suma de los valores
absolutos <em>predichos</em> y <em>observado</em>. El valor de este
cálculo se suma para cada punto ajustado <em>t</em> y se divide
nuevamente por el número de puntos ajustados n.</li>
<li><strong>rmse:</strong> Es la raíz de la media de los errores
elavados al cuadrado. Sirve para evalur el ajuste del modelo y sus
valores se expresan en la misma unidad de la variable proyectada.</li>
<li><strong>rsq:</strong> representa el coeficiente de determinación
utilizando una correlación. Toma valores entre 0 y 1 y describe el % de
variación de la variable de respuesta (transacciones, UT, etc.)
explicado por la variable que puede explicarse por el modelo.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div id="htmlwidget-608ffb7d52be76e85808" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-608ffb7d52be76e85808">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49"],["GBA","GBA","GBA","GBA","GBA","GBA","GBA","Cuyo","Cuyo","Cuyo","Cuyo","Cuyo","Cuyo","Cuyo","NEA","NEA","NEA","NEA","NEA","NEA","NEA","NOA","NOA","NOA","NOA","NOA","NOA","NOA","Pampeana","Pampeana","Pampeana","Pampeana","Pampeana","Pampeana","Pampeana","Patagonia","Patagonia","Patagonia","Patagonia","Patagonia","Patagonia","Patagonia","Nacional","Nacional","Nacional","Nacional","Nacional","Nacional","Nacional"],[1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7,1,2,3,4,5,6,7],["ARIMA(0,1,1)(1,0,0)[12] W/ XGBOOST ERRORS","SEASONAL DECOMP: ARIMA(0,1,1)","PROPHET W/ XGBOOST ERRORS","NNAR(1,1,10)[12]","EARTH","GLMNET","XGBOOST","ARIMA(1,1,1) W/ XGBOOST ERRORS","SEASONAL DECOMP: ARIMA(0,1,1)","PROPHET W/ XGBOOST ERRORS","NNAR(1,1,10)[12]","EARTH","GLMNET","XGBOOST","ARIMA(0,1,0) W/ XGBOOST ERRORS","SEASONAL DECOMP: ARIMA(0,1,0)","PROPHET W/ XGBOOST ERRORS","NNAR(1,1,10)[12]","EARTH","GLMNET","XGBOOST","ARIMA(0,1,2) W/ XGBOOST ERRORS","SEASONAL DECOMP: ARIMA(0,1,1)","PROPHET W/ XGBOOST ERRORS","NNAR(1,1,10)[12]","EARTH","GLMNET","XGBOOST","ARIMA(1,1,1) W/ XGBOOST ERRORS","SEASONAL DECOMP: ARIMA(0,1,1)","PROPHET W/ XGBOOST ERRORS","NNAR(1,1,10)[12]","EARTH","GLMNET","XGBOOST","ARIMA(0,1,0) W/ XGBOOST ERRORS","SEASONAL DECOMP: ARIMA(0,1,1)","PROPHET W/ XGBOOST ERRORS","NNAR(1,1,10)[12]","EARTH","GLMNET","XGBOOST","ARIMA(0,1,2) W/ XGBOOST ERRORS","SEASONAL DECOMP: ARIMA(0,1,1)","PROPHET W/ XGBOOST ERRORS","NNAR(1,1,10)[12]","EARTH","GLMNET","XGBOOST"],["Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test","Test"],[1.24,1.41,1.31,1.86,0.87,1.37,1.22,1.55,1.64,1.57,1.92,1.32,1.54,1.17,1.7,1.52,1.52,1.85,2.26,1.39,1.42,1.56,1.41,1.43,1.8,0.99,1.33,1.49,1.31,1.54,1.45,2.18,1.03,1.39,1.29,1.5,1.63,1.37,1.68,0.88,1.5,1.28,1.35,1.47,1.42,1.71,0.94,1.37,1.12],[33.49,33.35,31.13,37.7,18.19,28.32,24.14,38.41,45.52,44.47,45.54,30.31,37.96,24.96,32.95,33.46,34.4,39.82,47.58,30.43,27.97,34.09,30.79,32.34,40.82,28.07,28.85,30.37,27.3,36.56,35.2,48.93,20.96,30.33,26.24,33.56,39.52,33.07,31.04,19,31.54,25.86,30.02,34.72,34.85,35.69,20.29,29,21.77],[1.29,1.47,1.36,1.94,0.9,1.42,1.27,1.8,1.9,1.82,2.22,1.53,1.79,1.35,1.74,1.56,1.55,1.89,2.31,1.42,1.45,2.11,1.91,1.94,2.44,1.34,1.8,2.01,1.69,1.98,1.86,2.81,1.33,1.78,1.66,1.52,1.65,1.39,1.71,0.9,1.52,1.3,1.62,1.77,1.71,2.06,1.13,1.64,1.35],[28.4,32.05,29.82,48.48,19.37,31.86,28.27,36.76,37.71,36.1,46.71,31.98,36.48,26.95,41.29,34.34,33.98,43.3,65.27,30.92,33.09,36.34,32.62,32.72,42.18,23.63,30.57,36.28,30.65,35.38,33.39,53.43,23.25,31.71,29.61,34.39,36.19,30.87,40.57,19.36,34.13,28.84,31.06,33.53,32.38,41.01,21.1,31.33,25.36],[1.45,1.71,1.62,2.45,1.17,1.8,1.68,1.79,1.89,1.77,2.22,1.55,1.83,1.53,2.29,1.93,1.85,2.3,2.67,1.78,1.89,1.85,1.75,1.72,2.07,1.16,1.64,1.84,1.76,1.78,1.7,2.55,1.35,1.72,1.67,1.83,1.87,1.71,2.35,1.28,1.94,1.76,1.68,1.74,1.68,2.2,1.29,1.74,1.59],[0.11,0.01,0.01,0.15,0.63,0,0.28,0.19,0.15,0.04,0.28,0.43,0.03,0.32,0.09,0.09,0.02,0.23,0.04,0.01,0.04,0.01,0.01,0,0.15,0.63,0.02,0.1,0,0.1,0.01,0.44,0.58,0.01,0.06,0,0.11,0,0.05,0.6,0.02,0.13,0,0.06,0.01,0.27,0.36,0,0.29]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>name_serie<\/th>\n      <th>.model_id<\/th>\n      <th>.model_desc<\/th>\n      <th>.type<\/th>\n      <th>mae<\/th>\n      <th>mape<\/th>\n      <th>mase<\/th>\n      <th>smape<\/th>\n      <th>rmse<\/th>\n      <th>rsq<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":150,"columnDefs":[{"className":"dt-right","targets":[2,5,6,7,8,9,10]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,25,50,100,150]}},"evals":[],"jsHooks":[]}</script>
</div>
<h2 id="selección-del-mejor-modelo">Selección del mejor modelo 😎</h2>
<p>Luego de la evaluación de los distintos modelos, en base a las
métricas antes descriptas, en esta etapa se selecciona el modelo que
mejor se ajusta a los datos, es decir, aquél que menos error contenga en
la estimación. En este punto, se hace uso del método
<strong>modeltime_multibestmodel</strong> de la libreria
<strong>timetk</strong> y se toma el <strong>RMSE</strong> como métrica
para seleccionar el mejor modelo.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>best_model_ipc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/sknifedatar/man/modeltime_multibestmodel.html'>modeltime_multibestmodel</a></span><span class='op'>(</span>
  .table <span class='op'>=</span> <span class='va'>model_table_ipc</span><span class='op'>$</span><span class='va'>table_time</span>,
  .metric <span class='op'>=</span> <span class='st'>"rmse"</span>,
  .minimize <span class='op'>=</span> <span class='cn'>TRUE</span>,
  .forecast <span class='op'>=</span> <span class='cn'>FALSE</span>
  
<span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="modelo-con-mejor-performance-por-región">Modelo con mejor
performance por región</h3>
<div class="layout-chunk" data-layout="l-body">
<pre><code>##      Region  Modelo
## 1       GBA   EARTH
## 2      Cuyo XGBOOST
## 3       NEA  GLMNET
## 4       NOA   EARTH
## 5  Pampeana   EARTH
## 6 Patagonia   EARTH
## 7  Nacional   EARTH</code></pre>
</div>
<h2 id="entrenamiento-del-mejor-modelo">Entrenamiento del mejor modelo
🏋</h2>
<p>En esta etapa entrenamos nuestros datos con el modelo que mejor
performance mostró según la métrica seleccionada en el paso anterior (en
nuestro caso RMSE). Además se entrena el modelo con la totalidad de
datos.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>model_refit_ipc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/sknifedatar/man/modeltime_multirefit.html'>modeltime_multirefit</a></span><span class='op'>(</span><span class='va'>best_model_ipc</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<h2 id="forecast-datos">Forecast datos 🔮</h2>
<p>Por último, con el modelo entrenado realizamos nuestras proyecciones
(forecast), para un período de 12 meses</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>forecast_ipc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/sknifedatar/man/modeltime_multiforecast.html'>modeltime_multiforecast</a></span><span class='op'>(</span>models_table <span class='op'>=</span> <span class='va'>model_refit_ipc</span>,
                                           .h <span class='op'>=</span> <span class='fl'>12</span>,
                                           .prop <span class='op'>=</span> <span class='va'>split</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>grafico</span> <span class='op'>&lt;-</span> <span class='va'>forecast_ipc</span> <span class='op'><a href='https://business-science.github.io/modeltime/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'>plot_time_series</span><span class='op'>(</span>df <span class='op'>=</span> <span class='va'>.</span>,title <span class='op'>=</span> <span class='st'>"Forecast IPC"</span>,
                   y_lab <span class='op'>=</span> <span class='st'>"IPC mensual"</span>,
                   x <span class='op'>=</span> <span class='st'>"Mes"</span>,
                   y <span class='op'>=</span> <span class='st'>"IPC"</span>,
                   facet <span class='op'>=</span> <span class='st'>"Region"</span><span class='op'>)</span>
<span class='va'>grafico</span>
</code></pre>
</div>
<p><img src="ajuste-multiples-series-de-tiempo_files/figure-html5/unnamed-chunk-23-1.png" width="960" /></p>
</div>
<h2 id="algunos-comentarios">Algunos comentarios 🗣</h2>
<p>👉🏼 No quedan dudas de que los autores de los paquetes aquí revisados
(Modeltime, Timetk, Sknifedatar), han hecho un gran aporte para
facilitar el trabajo con series de tiempo y modelos en contextos
habituales dónde la labor se centra en ajustar mútiples modelos y series
de tiempo.</p>
<p>Este flujo de trabajo de ha sido muy útil y espero que les sea a
quién lea este material 👐.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
